---
title: "#RStats Wrapped 2023"
author: "Patrick Coyle"
date: today
categories: [code, analysis]
# image: ""
---

Source: <https://nrennie.rbind.io/blog/2022-12-03-how-to-make-your-own-rstats-wrapped/>

```{r, fig.width = 2.5, fig.height = 5}
library(NCmisc)
library(janitor)
library(dplyr)
library(purrr)
library(patchwork)
library(showtext)
library(here)
library(ggtextures) ## devtools::install_github("clauswilke/ggtextures")
library(ggplot2)
library(stringr)
all_functions <- list.files(
  path = "C:/Users/Patrick/Documents/R_projects", 
  recursive = TRUE,
  full.names = TRUE
) %>%
  as_tibble() %>%
  mutate(filetype = str_extract(value, pattern = "\\..*")) %>%
  filter(filetype == ".R") %>%
  pull(value) %>% 
  map(~.x %>% 
        NCmisc::list.functions.in.file() %>% 
        .[setdiff(names(.), "package:base")]
  )
func_data <- all_functions %>% 
  unlist() %>% 
  unname() %>% 
  tabyl() %>% 
  as_tibble() %>% 
  rename(func = ".") %>% 
  slice_max(n, n = 5, with_ties = FALSE) 
imgs <- tibble(img = c("https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/here.png",
                       "https://raw.githubusercontent.com/rstudio/hex-stickers/main/thumbs/purrr.png",
                       "https://raw.githubusercontent.com/rstudio/hex-stickers/main/thumbs/dplyr.png",
                       "https://raw.githubusercontent.com/rstudio/hex-stickers/main/thumbs/quarto.png",
                       "https://raw.githubusercontent.com/rstudio/hex-stickers/main/thumbs/ggplot2.png"))
font_add_google("Raleway", "raleway")
showtext_auto()
set.seed(2023)
curve1 <- tibble(x = 1:100) %>%
  mutate(y = 20 + smooth(cumsum(rnorm(100))))
inset1 <- ggplot(data = curve1, aes(x = x, y = y)) +
  geom_area(fill = "#f76ec0") +
  theme_void() +
  coord_fixed() +
  scale_y_reverse()
p <- ggplot() +
  # add text with the numbers 1 to 5
  geom_text(data = data.frame(),
            mapping = aes(x = rep(1, 5),
                          y = 1:5,
                          label = paste0("#", 1:5)),
            colour = "#1a2e72",
            size = 20,
            fontface = "bold",
            family = "raleway") +
  # add text with the names of the functions, and the number of times its used
  geom_text(data = func_data,
            mapping = aes(x = rep(2.15, 5),
                          y = 1:5,
                          label = paste0(func, "() (", n, ")")),
            colour = "#143b1c",
            hjust = 0,
            size = 10,
            fontface = "bold",
            family = "raleway") +
  # add images for each package
  geom_textured_rect(data = imgs,
                     aes(xmin = rep(1.4, 5), xmax = rep(2, 5),
                         ymax = 1:5-0.346, ymin = 1:5+0.346, image = img),
                     lty = "blank",
                     fill="transparent",
                     nrow = 1,
                     ncol = 1,
                     img_width = unit(1, "null"),
                     img_height = unit(1, "null"),
                     position = "identity")  +
  # add title using geom_text() instead of labs()
  geom_text(data = data.frame(),
            aes(x = 2.45, y = 0, label = "My Top Functions"),
            colour = "#1a2e72",
            fontface = "bold",
            hjust = 0.5,
            size = 14,
            family = "raleway") +
  # set axis limits and reverse y axis
  scale_x_continuous(limits = c(0.9, 4)) +
  scale_y_reverse(limits = c(5.5, -0.2)) +
  # add a caption
  labs(caption = "#RStats") +
  # set the theme
  theme_void() +
  theme(plot.background = element_rect(fill = "#96efb7", colour = "#96efb7"),
        panel.background = element_rect(fill = "#96efb7", colour = "#96efb7"),
        plot.margin = margin(40, 15, 10, 15),
        plot.caption = element_text(colour = "#1a2e72",
                                    margin = margin(t = 15),
                                    face = "bold",
                                    hjust = 1,
                                    size = 30,
                                    family = "raleway"))
p + 
  inset_element(inset1, left = -1, right = 1.2, bottom = 0, top = 2.2, align_to = "full") &
  theme(plot.background = element_rect(fill = "#96efb7", colour = "#96efb7"),
        panel.background = element_rect(fill = "#96efb7", colour = "#96efb7"),
        plot.margin = margin(40, 7, 5, 7),
        plot.caption = element_text(colour = "#1a2e72",
                                    margin = margin(t = 5),
                                    face = "bold",
                                    hjust = 1,
                                    size = 30))
ggsave("rstats_wrapped_2023.png", width = 2.5, height = 5, units = "in")
```
